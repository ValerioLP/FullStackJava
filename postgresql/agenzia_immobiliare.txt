--creo la view dove lavorare
create view possedimenti as
select immobile.codice as immobile_codice, tipo, superficie, prezzo_vendita, 
numero_vani, anno_fabbricazione, annessi, proprietari.codice as proprietario_codice,
nome, cognome from immobile, proprietari, possedimento_immobili
where possedimento_immobili.codice_proprietario = proprietari.codice and
	  possedimento_immobili.codice_immobile = immobile.codice;

select * from possedimenti order by superficie desc;

--1.Vogliamo sapere quanti box sono presenti nel database
select count(*) as numero_box from immobile
	where annessi = 'garage';
	
--2.Vogliamo sapere quante ville hanno a disposizione un giardino.
select count(*) as ville_con_giardino from immobile
	where annessi = 'giardino' and tipo = 'Villa';
	
--3.Vogliamo sapere quanti mq di superficie dispone uno specificato 
--proprietario solo sugli immobili.	
select nome, sum(superficie) as mq_totali_posseduti from possedimenti
	where nome = 'Franco'
	group by nome;
	
--4.Elencare tutti i possessori di una villa.
select nome, cognome from possedimenti
	where tipo = 'Villa';
	
--5.Elencare tutti i possessori di un appartamento con Box.
select nome, cognome from possedimenti
	where tipo = 'Appartamento' and annessi = 'garage';
	
--6.Elencare tutti i possessori di immobili la cui data di 
--costruzione Ã¨ successiva al 1996.
select nome, cognome from possedimenti
	where anno_fabbricazione > '1996-01-01'
	
--7.Produrre una vista dei proprietari di appartamenti con a fianco 
--il numero di vani complessivi disponibili.
create view appartamenti as
select nome, cognome, sum(numero_vani) as totale_vani
	from possedimenti where tipo = 'Appartamento'
	group by nome, cognome;
	
select * from appartamenti;

--8.Produrre una vista dei proprietari la cui somma dei mq degli 
--immobili posseduti sia superiore a 400 mq.
create view over_400mq as
select nome, cognome, sum(superficie) as somma_superficie
	from possedimenti
	group by nome, cognome
	having sum(superficie) > 400;
	
select * from over_400mq;